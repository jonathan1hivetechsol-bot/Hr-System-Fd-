import{d as e,r as a,j as t,e as s,R as r,f as l,n as i,o as n,L as o,P as d}from"./vendor-react-DP1fVbuu.js";import{u as m,a as c,s as h}from"../index-rw7h0ijr.js";import{r as p,u,d as g}from"./vendor-firebase-Dc8JVVU0.js";import{l as x}from"./logo-1JtIC0mN.js";import"./vendor-icons-DoxuJXhj.js";const f={maxWidth:1200,maxHeight:1200,quality:.8,maxSizeKB:500};async function j(e,a={}){const t={...f,...a};return new Promise((a,s)=>{const r=new FileReader;r.onload=r=>{const l=new Image;l.onload=()=>{const r=document.createElement("canvas");let i=l.width,n=l.height;t.maxWidth&&i>t.maxWidth&&(n=n*t.maxWidth/i,i=t.maxWidth),t.maxHeight&&n>t.maxHeight&&(i=i*t.maxHeight/n,n=t.maxHeight),r.width=i,r.height=n;const o=r.getContext("2d");o?(o.drawImage(l,0,0,i,n),r.toBlob(r=>{if(!r)return void s(new Error("Failed to compress image"));const l=r.size/1024;if(t.maxSizeKB&&l>t.maxSizeKB){const r=.9*(t.quality||.8);return void j(e,{...t,quality:r}).then(a).catch(s)}const i=new File([r],e.name,{type:"image/jpeg",lastModified:Date.now()});a(i)},"image/jpeg",t.quality)):s(new Error("Failed to get canvas context"))},l.onerror=()=>{s(new Error("Failed to load image"))},l.src=r.target?.result},r.onerror=()=>{s(new Error("Failed to read file"))},r.readAsDataURL(e)})}async function b(e,a={}){try{return await Promise.all(e.map(e=>j(e,a)))}catch(t){throw t}}const y=()=>{const t=e(),{user:s,userProfile:r}=m(),[l,i]=a.useState(!1),[n,o]=a.useState(0),[d,x]=a.useState({phone:"",address:"",dateOfBirth:"",position:"",department:"",designations:"",profileImages:[]}),[f,j]=a.useState([]),[y,N]=a.useState({});return{formData:d,errors:y,loading:l,uploadProgress:n,imagePreviews:f,handleChange:e=>{const{name:a,value:t}=e.target;x(e=>({...e,[a]:t})),y[a]&&N(e=>{const t={...e};return delete t[a],t})},handleImageChange:e=>{const a=Array.from(e.target.files||[]).slice(0,2),t=[],s=[];let r=!1;for(const l of a){if(l.size>5242880){N(e=>({...e,profileImage:"Each image size should be less than 5MB"})),r=!0;break}s.push(l);const e=new FileReader;e.onloadend=()=>{t.push(e.result),t.length===a.length&&j(t)},e.readAsDataURL(l)}!r&&s.length>0&&(x(e=>({...e,profileImages:s})),y.profileImage&&N(e=>{const a={...e};return delete a.profileImage,a}))},removeImage:e=>{const a=f.filter((a,t)=>t!==e),t=d.profileImages.filter((a,t)=>t!==e);j(a),x(e=>({...e,profileImages:t}))},handleSubmit:async e=>{if(e.preventDefault(),!(()=>{const e={};return d.phone.trim()||(e.phone="Phone number is required"),d.address.trim()||(e.address="Address is required"),d.dateOfBirth||(e.dateOfBirth="Date of birth is required"),d.position.trim()||(e.position="Position is required"),d.department.trim()||(e.department="Department is required"),0===d.profileImages.length&&(e.profileImage="At least one profile image is required"),N(e),0===Object.keys(e).length})())return;i(!0),N({});const a=setTimeout(()=>{i(!1),N({submit:"Profile completion is taking too long. Please check your connection and try again."}),o(0)},6e4);try{if(!s)return clearTimeout(a),N({submit:"User not authenticated. Please login again."}),void i(!1);const e=await(async()=>{if(0===d.profileImages.length||!s)return null;try{const e=await b(d.profileImages,{maxWidth:1200,maxHeight:1200,quality:.75,maxSizeKB:400}),a=[];for(let t=0;t<e.length;t++){const r=e[t],l=`profile-${s.uid}-${t}-${Date.now()}`,i=p(h,`employee-profiles/${s.uid}/${l}`),n=u(i,r),d=await new Promise((a,s)=>{const r=setTimeout(()=>{s(new Error("Image upload timeout - taking too long. Please check your connection."))},6e4);n.on("state_changed",a=>{const s=100*e.length,r=(100*t+a.bytesTransferred/a.totalBytes*100)/s*100;o(r)},e=>{clearTimeout(r),s(new Error(`Image upload failed: ${e.message}`))},async()=>{clearTimeout(r);try{const e=await g(n.snapshot.ref);a(e)}catch(e){s(new Error("Failed to get download URL"))}})});a.push(d)}return a}catch(e){return null}})();if(!e||0===e.length)return clearTimeout(a),N({submit:"Failed to upload profile images. Please check file size (max 5MB each) and try again."}),void i(!1);const r={phone:d.phone,address:d.address,dateOfBirth:d.dateOfBirth,position:d.position,department:d.department,designations:d.designations,profileImages:e,profileImage:e[0],profileComplete:!0,updatedAt:new Date},l=await c("employees",s.uid,r);l.success?(await c("users",s.uid,{profileComplete:!0,updatedAt:new Date}).catch(e=>{}),clearTimeout(a),setTimeout(()=>{t("/dashboards/dashboard/employee",{replace:!0})},500)):(clearTimeout(a),N({submit:l.error||"Failed to update profile. Please try again."}),i(!1))}catch(r){clearTimeout(a),N({submit:r instanceof Error?r.message:"An unexpected error occurred. Please try again."}),i(!1)}finally{o(0)}}}};(new Date).getFullYear();const N=["Sales","Social Media","SEO and Dev","Cleaning","Helper","Assistant","Accountant","Manager","HR","Worker"],v=()=>{const{formData:e,errors:a,loading:m,uploadProgress:c,imagePreviews:h,handleChange:p,handleImageChange:u,removeImage:g,handleSubmit:f}=y();return t.jsx("div",{className:"bg-gradient2 min-vh-100 align-items-center d-flex justify-content-center pt-2 pt-sm-5 pb-4 pb-sm-5",children:t.jsx(s,{children:t.jsx(r,{className:"justify-content-center",children:t.jsx(l,{lg:10,xl:8,children:t.jsx(i,{children:t.jsxs(n,{className:"p-4 p-sm-5",children:[t.jsx("div",{className:"mx-auto mb-4",children:t.jsx(o,{to:"/",className:"d-flex",children:t.jsx("img",{src:x,className:"align-self-center",alt:"logo-img",height:30})})}),t.jsx("h4",{className:"h4 mb-1 mt-4",children:"Complete Your Profile"}),t.jsx("p",{className:"text-muted mb-4",children:"Please fill in your profile information to get started."}),t.jsxs("form",{onSubmit:f,children:[t.jsxs(r,{children:[t.jsx(l,{md:6,children:t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{htmlFor:"phone",className:"form-label",children:["Phone Number ",t.jsx("small",{children:"*"})]}),t.jsx("input",{type:"tel",className:"form-control",id:"phone",placeholder:"Phone Number",name:"phone",value:e.phone,onChange:p}),a.phone&&t.jsx("small",{className:"text-danger",children:a.phone})]})}),t.jsx(l,{md:6,children:t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{htmlFor:"dateOfBirth",className:"form-label",children:["Date of Birth ",t.jsx("small",{children:"*"})]}),t.jsx("input",{type:"date",className:"form-control",id:"dateOfBirth",name:"dateOfBirth",value:e.dateOfBirth,onChange:p}),a.dateOfBirth&&t.jsx("small",{className:"text-danger",children:a.dateOfBirth})]})})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{htmlFor:"address",className:"form-label",children:["Address ",t.jsx("small",{children:"*"})]}),t.jsx("textarea",{className:"form-control",id:"address",placeholder:"Enter your address",name:"address",value:e.address,onChange:p,rows:3}),a.address&&t.jsx("small",{className:"text-danger",children:a.address})]}),t.jsxs(r,{children:[t.jsx(l,{md:6,children:t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{htmlFor:"position",className:"form-label",children:["Position ",t.jsx("small",{children:"*"})]}),t.jsx("input",{type:"text",className:"form-control",id:"position",placeholder:"Your Position",name:"position",value:e.position,onChange:p}),a.position&&t.jsx("small",{className:"text-danger",children:a.position})]})}),t.jsx(l,{md:6,children:t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{htmlFor:"department",className:"form-label",children:["Department ",t.jsx("small",{children:"*"})]}),t.jsxs("select",{className:"form-control",id:"department",name:"department",value:e.department,onChange:p,children:[t.jsx("option",{value:"",children:"Select Department"}),N.map(e=>t.jsx("option",{value:e,children:e},e))]}),a.department&&t.jsx("small",{className:"text-danger",children:a.department})]})})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{htmlFor:"designations",className:"form-label",children:"Designations / Skills"}),t.jsx("input",{type:"text",className:"form-control",id:"designations",placeholder:"e.g., Software Developer, Team Lead",name:"designations",value:e.designations,onChange:p})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{htmlFor:"profileImage",className:"form-label",children:["Profile Pictures (Up to 2) ",t.jsx("small",{children:"*"})]}),t.jsx("div",{className:"border-2 border-dashed p-4 text-center rounded",style:{cursor:"pointer"},children:h.length>0?t.jsxs("div",{children:[t.jsx("div",{className:"row g-3 mb-3",children:h.map((e,a)=>t.jsx("div",{className:"col-md-6",children:t.jsxs("div",{className:"position-relative",children:[t.jsx("img",{src:e,alt:`Preview ${a+1}`,className:"img-fluid rounded",style:{maxHeight:"150px",objectFit:"cover",width:"100%"}}),t.jsx("button",{type:"button",className:"btn btn-sm btn-danger position-absolute top-0 end-0 m-2",onClick:()=>g(a),title:"Remove image",children:"Ã—"})]})},a))}),t.jsxs("p",{className:"text-muted small mb-2",children:[h.length," of 2 photos selected"]}),t.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",multiple:!0,onChange:u,style:{display:"none"}}),h.length<2&&t.jsx("button",{type:"button",className:"btn btn-sm btn-outline-primary me-2",onClick:()=>document.getElementById("profileImage")?.click(),children:"Add More Photos"}),t.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{const e=document.getElementById("profileImage");e&&(e.value=""),g(0)},children:"Clear All"})]}):t.jsxs("div",{onClick:()=>document.getElementById("profileImage")?.click(),children:[t.jsxs("svg",{className:"mb-3",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),t.jsx("polyline",{points:"21 15 16 10 5 21"})]}),t.jsx("p",{className:"text-muted mb-2",children:"Click to upload profile pictures"}),t.jsx("p",{className:"small text-muted mb-0",children:"(JPG, PNG - Max 5MB per file, up to 2 photos)"}),t.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",multiple:!0,onChange:u,style:{display:"none"}})]})}),a.profileImage&&t.jsx("small",{className:"text-danger d-block mt-2",children:a.profileImage})]}),c>0&&c<100&&t.jsxs("div",{className:"mb-3",children:[t.jsxs("p",{className:"text-muted mb-2",children:["Uploading... ",Math.round(c),"%"]}),t.jsx(d,{now:c})]}),a.submit&&t.jsx("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:a.submit}),t.jsx("div",{className:"mb-0 text-center d-grid gap-2",children:t.jsx("button",{className:"btn btn-primary",type:"submit",disabled:m||c>0,children:m?"Completing Profile...":"Complete Profile & Continue"})})]})]})})})})})})};export{v as default};
