import{u as B,h as S,r as x,i as E,k as F,s as O,m as R,n as k,j as e,C as A,R as N,a as j,L as U}from"./index-DJIrYS2O.js";import{l as L}from"./logo-BJuW9rqy.js";import{C as q,a as T}from"./Card-BEgR1SuR.js";import{P as M}from"./ProgressBar-CFNDcQjm.js";const $=()=>{const n=B(),{user:s,userProfile:p}=S(),[m,u]=x.useState(!1),[o,g]=x.useState(0),[r,f]=x.useState({phone:"",address:"",dateOfBirth:"",position:"",department:"",designations:"",profileImage:null}),[v,y]=x.useState(null),[b,d]=x.useState({}),C=a=>{const{name:t,value:i}=a.target;f(l=>({...l,[t]:i})),b[t]&&d(l=>{const c={...l};return delete c[t],c})},P=a=>{const t=a.target.files?.[0];if(t){if(t.size>5*1024*1024){d(l=>({...l,profileImage:"Image size should be less than 5MB"}));return}f(l=>({...l,profileImage:t}));const i=new FileReader;i.onloadend=()=>{y(i.result)},i.readAsDataURL(t),b.profileImage&&d(l=>{const c={...l};return delete c.profileImage,c})}},w=()=>{const a={};return r.phone.trim()||(a.phone="Phone number is required"),r.address.trim()||(a.address="Address is required"),r.dateOfBirth||(a.dateOfBirth="Date of birth is required"),r.position.trim()||(a.position="Position is required"),r.department.trim()||(a.department="Department is required"),r.profileImage||(a.profileImage="Profile image is required"),d(a),Object.keys(a).length===0},D=async()=>{if(!r.profileImage||!s)return null;try{const a=`profile-${s.uid}-${Date.now()}`,t=F(O,`employee-profiles/${s.uid}/${a}`),i=R(t,r.profileImage);return new Promise((l,c)=>{i.on("state_changed",h=>{const I=h.bytesTransferred/h.totalBytes*100;g(I)},h=>{console.error("Upload error:",h),c(h)},async()=>{const h=await k(i.snapshot.ref);l(h)})})}catch(a){return console.error("Error uploading image:",a),null}};return{formData:r,errors:b,loading:m,uploadProgress:o,imagePreview:v,handleChange:C,handleImageChange:P,handleSubmit:async a=>{if(a.preventDefault(),!!w()){u(!0);try{const t=await D();if(!t){d({submit:"Failed to upload profile image"}),u(!1);return}if(p&&p.id){const i={phone:r.phone,address:r.address,dateOfBirth:r.dateOfBirth,position:r.position,department:r.department,designations:r.designations,profileImage:t,profileComplete:!0,updatedAt:new Date},l=await E("employees",p.id,i);l.success?setTimeout(()=>{n("/dashboards/dashboard",{replace:!0})},500):d({submit:l.error||"Failed to update profile"})}else d({submit:"User profile not found"})}catch(t){d({submit:t instanceof Error?t.message:"An error occurred"})}finally{u(!1),g(0)}}}}};new Date().getFullYear();const H=["Sales","Social Media","SEO and Dev","Cleaning","Helper","Assistant","Accountant","Manager","HR","Worker"],J=()=>{const{formData:n,errors:s,loading:p,uploadProgress:m,imagePreview:u,handleChange:o,handleImageChange:g,handleSubmit:r}=$();return e.jsx("div",{className:"bg-gradient2 min-vh-100 align-items-center d-flex justify-content-center pt-2 pt-sm-5 pb-4 pb-sm-5",children:e.jsx(A,{children:e.jsx(N,{className:"justify-content-center",children:e.jsx(j,{lg:10,xl:8,children:e.jsx(q,{children:e.jsxs(T,{className:"p-4 p-sm-5",children:[e.jsx("div",{className:"mx-auto mb-4",children:e.jsx(U,{to:"/",className:"d-flex",children:e.jsx("img",{src:L,className:"align-self-center",alt:"logo-img",height:30})})}),e.jsx("h4",{className:"h4 mb-1 mt-4",children:"Complete Your Profile"}),e.jsx("p",{className:"text-muted mb-4",children:"Please fill in your profile information to get started."}),e.jsxs("form",{onSubmit:r,children:[e.jsxs(N,{children:[e.jsx(j,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"phone",className:"form-label",children:["Phone Number ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"tel",className:"form-control",id:"phone",placeholder:"Phone Number",name:"phone",value:n.phone,onChange:o}),s.phone&&e.jsx("small",{className:"text-danger",children:s.phone})]})}),e.jsx(j,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"dateOfBirth",className:"form-label",children:["Date of Birth ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"date",className:"form-control",id:"dateOfBirth",name:"dateOfBirth",value:n.dateOfBirth,onChange:o}),s.dateOfBirth&&e.jsx("small",{className:"text-danger",children:s.dateOfBirth})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"address",className:"form-label",children:["Address ",e.jsx("small",{children:"*"})]}),e.jsx("textarea",{className:"form-control",id:"address",placeholder:"Enter your address",name:"address",value:n.address,onChange:o,rows:3}),s.address&&e.jsx("small",{className:"text-danger",children:s.address})]}),e.jsxs(N,{children:[e.jsx(j,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"position",className:"form-label",children:["Position ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",id:"position",placeholder:"Your Position",name:"position",value:n.position,onChange:o}),s.position&&e.jsx("small",{className:"text-danger",children:s.position})]})}),e.jsx(j,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"department",className:"form-label",children:["Department ",e.jsx("small",{children:"*"})]}),e.jsxs("select",{className:"form-control",id:"department",name:"department",value:n.department,onChange:o,children:[e.jsx("option",{value:"",children:"Select Department"}),H.map(f=>e.jsx("option",{value:f,children:f},f))]}),s.department&&e.jsx("small",{className:"text-danger",children:s.department})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"designations",className:"form-label",children:"Designations / Skills"}),e.jsx("input",{type:"text",className:"form-control",id:"designations",placeholder:"e.g., Software Developer, Team Lead",name:"designations",value:n.designations,onChange:o})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"profileImage",className:"form-label",children:["Profile Picture ",e.jsx("small",{children:"*"})]}),e.jsx("div",{className:"border-2 border-dashed p-4 text-center rounded",children:u?e.jsxs("div",{children:[e.jsx("img",{src:u,alt:"Preview",className:"img-fluid rounded mb-3",style:{maxHeight:"200px"}}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",onChange:g})})]}):e.jsxs("div",{children:[e.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",onChange:g}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Click to upload your profile picture"})]})}),s.profileImage&&e.jsx("small",{className:"text-danger d-block mt-2",children:s.profileImage})]}),m>0&&m<100&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-muted mb-2",children:["Uploading... ",Math.round(m),"%"]}),e.jsx(M,{now:m})]}),s.submit&&e.jsx("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:s.submit}),e.jsx("div",{className:"mb-0 text-center d-grid gap-2",children:e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:p||m>0,children:p?"Completing Profile...":"Complete Profile & Continue"})})]})]})})})})})})};export{J as default};
