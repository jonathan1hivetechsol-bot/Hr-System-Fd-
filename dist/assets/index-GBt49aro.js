import{u as B,h as E,r as x,i as S,k as F,s as O,m as R,n as U,j as e,C as k,R as N,a as j,L as A}from"./index-DVszvYIw.js";import{l as L}from"./logo-BJuW9rqy.js";import{C as q,a as M}from"./Card-DMtR7sEa.js";import{P as T}from"./ProgressBar-D3zB7v6y.js";const $=()=>{const d=B(),{user:s,userProfile:u}=E(),[p,o]=x.useState(!1),[m,g]=x.useState(0),[r,f]=x.useState({phone:"",address:"",dateOfBirth:"",position:"",department:"",designations:"",profileImage:null}),[v,y]=x.useState(null),[b,i]=x.useState({}),P=a=>{const{name:t,value:n}=a.target;f(l=>({...l,[t]:n})),b[t]&&i(l=>{const c={...l};return delete c[t],c})},C=a=>{const t=a.target.files?.[0];if(t){if(t.size>5*1024*1024){i(l=>({...l,profileImage:"Image size should be less than 5MB"}));return}f(l=>({...l,profileImage:t}));const n=new FileReader;n.onloadend=()=>{y(n.result)},n.readAsDataURL(t),b.profileImage&&i(l=>{const c={...l};return delete c.profileImage,c})}},w=()=>{const a={};return r.phone.trim()||(a.phone="Phone number is required"),r.address.trim()||(a.address="Address is required"),r.dateOfBirth||(a.dateOfBirth="Date of birth is required"),r.position.trim()||(a.position="Position is required"),r.department.trim()||(a.department="Department is required"),r.profileImage||(a.profileImage="Profile image is required"),i(a),Object.keys(a).length===0},I=async()=>{if(!r.profileImage||!s)return null;try{const a=`profile-${s.uid}-${Date.now()}`,t=F(O,`employee-profiles/${s.uid}/${a}`),n=R(t,r.profileImage);return new Promise((l,c)=>{n.on("state_changed",h=>{const D=h.bytesTransferred/h.totalBytes*100;g(D)},h=>{console.error("Upload error:",h),c(new Error(`Image upload failed: ${h.message}`))},async()=>{try{const h=await U(n.snapshot.ref);l(h)}catch{c(new Error("Failed to get download URL"))}})})}catch(a){return console.error("Error uploading image:",a),null}};return{formData:r,errors:b,loading:p,uploadProgress:m,imagePreview:v,handleChange:P,handleImageChange:C,handleSubmit:async a=>{if(a.preventDefault(),!!w()){o(!0),i({});try{if(!s){i({submit:"User not authenticated. Please login again."}),o(!1);return}if(!u||!u.id){i({submit:"User profile not found. Please login again."}),o(!1);return}const t=await I();if(!t){i({submit:"Failed to upload profile image. Please check file size (max 5MB) and try again."}),o(!1);return}const n={phone:r.phone,address:r.address,dateOfBirth:r.dateOfBirth,position:r.position,department:r.department,designations:r.designations,profileImage:t,profileComplete:!0,updatedAt:new Date},l=await S("employees",u.id,n);l.success?setTimeout(()=>{d("/dashboards/dashboard",{replace:!0})},500):(i({submit:l.error||"Failed to update profile. Please try again."}),o(!1))}catch(t){console.error("Profile completion error:",t),i({submit:t instanceof Error?t.message:"An unexpected error occurred. Please try again."}),o(!1)}finally{g(0)}}}}};new Date().getFullYear();const z=["Sales","Social Media","SEO and Dev","Cleaning","Helper","Assistant","Accountant","Manager","HR","Worker"],J=()=>{const{formData:d,errors:s,loading:u,uploadProgress:p,imagePreview:o,handleChange:m,handleImageChange:g,handleSubmit:r}=$();return e.jsx("div",{className:"bg-gradient2 min-vh-100 align-items-center d-flex justify-content-center pt-2 pt-sm-5 pb-4 pb-sm-5",children:e.jsx(k,{children:e.jsx(N,{className:"justify-content-center",children:e.jsx(j,{lg:10,xl:8,children:e.jsx(q,{children:e.jsxs(M,{className:"p-4 p-sm-5",children:[e.jsx("div",{className:"mx-auto mb-4",children:e.jsx(A,{to:"/",className:"d-flex",children:e.jsx("img",{src:L,className:"align-self-center",alt:"logo-img",height:30})})}),e.jsx("h4",{className:"h4 mb-1 mt-4",children:"Complete Your Profile"}),e.jsx("p",{className:"text-muted mb-4",children:"Please fill in your profile information to get started."}),e.jsxs("form",{onSubmit:r,children:[e.jsxs(N,{children:[e.jsx(j,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"phone",className:"form-label",children:["Phone Number ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"tel",className:"form-control",id:"phone",placeholder:"Phone Number",name:"phone",value:d.phone,onChange:m}),s.phone&&e.jsx("small",{className:"text-danger",children:s.phone})]})}),e.jsx(j,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"dateOfBirth",className:"form-label",children:["Date of Birth ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"date",className:"form-control",id:"dateOfBirth",name:"dateOfBirth",value:d.dateOfBirth,onChange:m}),s.dateOfBirth&&e.jsx("small",{className:"text-danger",children:s.dateOfBirth})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"address",className:"form-label",children:["Address ",e.jsx("small",{children:"*"})]}),e.jsx("textarea",{className:"form-control",id:"address",placeholder:"Enter your address",name:"address",value:d.address,onChange:m,rows:3}),s.address&&e.jsx("small",{className:"text-danger",children:s.address})]}),e.jsxs(N,{children:[e.jsx(j,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"position",className:"form-label",children:["Position ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",id:"position",placeholder:"Your Position",name:"position",value:d.position,onChange:m}),s.position&&e.jsx("small",{className:"text-danger",children:s.position})]})}),e.jsx(j,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"department",className:"form-label",children:["Department ",e.jsx("small",{children:"*"})]}),e.jsxs("select",{className:"form-control",id:"department",name:"department",value:d.department,onChange:m,children:[e.jsx("option",{value:"",children:"Select Department"}),z.map(f=>e.jsx("option",{value:f,children:f},f))]}),s.department&&e.jsx("small",{className:"text-danger",children:s.department})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"designations",className:"form-label",children:"Designations / Skills"}),e.jsx("input",{type:"text",className:"form-control",id:"designations",placeholder:"e.g., Software Developer, Team Lead",name:"designations",value:d.designations,onChange:m})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"profileImage",className:"form-label",children:["Profile Picture ",e.jsx("small",{children:"*"})]}),e.jsx("div",{className:"border-2 border-dashed p-4 text-center rounded",children:o?e.jsxs("div",{children:[e.jsx("img",{src:o,alt:"Preview",className:"img-fluid rounded mb-3",style:{maxHeight:"200px"}}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",onChange:g})})]}):e.jsxs("div",{children:[e.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",onChange:g}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Click to upload your profile picture"})]})}),s.profileImage&&e.jsx("small",{className:"text-danger d-block mt-2",children:s.profileImage})]}),p>0&&p<100&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-muted mb-2",children:["Uploading... ",Math.round(p),"%"]}),e.jsx(T,{now:p})]}),s.submit&&e.jsx("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:s.submit}),e.jsx("div",{className:"mb-0 text-center d-grid gap-2",children:e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:u||p>0,children:u?"Completing Profile...":"Complete Profile & Continue"})})]})]})})})})})})};export{J as default};
