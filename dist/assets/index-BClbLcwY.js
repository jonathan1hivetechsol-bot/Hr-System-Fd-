import{u as E,h as S,r as g,i as v,k as F,s as O,m as R,n as k,j as e,C as A,R as N,a as x,L as U}from"./index-oF94shAn.js";import{l as L}from"./logo-BJuW9rqy.js";import{C as q,a as M}from"./Card-BhaUZ5Ll.js";import{P as T}from"./ProgressBar-DQqGa84c.js";const $=()=>{const d=E(),{user:s,userProfile:j}=S(),[h,m]=g.useState(!1),[c,f]=g.useState(0),[r,u]=g.useState({phone:"",address:"",dateOfBirth:"",position:"",department:"",designations:"",profileImage:null}),[y,P]=g.useState(null),[b,o]=g.useState({}),C=a=>{const{name:t,value:i}=a.target;u(l=>({...l,[t]:i})),b[t]&&o(l=>{const n={...l};return delete n[t],n})},w=a=>{const t=a.target.files?.[0];if(t){if(t.size>5*1024*1024){o(l=>({...l,profileImage:"Image size should be less than 5MB"}));return}u(l=>({...l,profileImage:t}));const i=new FileReader;i.onloadend=()=>{P(i.result)},i.readAsDataURL(t),b.profileImage&&o(l=>{const n={...l};return delete n.profileImage,n})}},D=()=>{const a={};return r.phone.trim()||(a.phone="Phone number is required"),r.address.trim()||(a.address="Address is required"),r.dateOfBirth||(a.dateOfBirth="Date of birth is required"),r.position.trim()||(a.position="Position is required"),r.department.trim()||(a.department="Department is required"),r.profileImage||(a.profileImage="Profile image is required"),o(a),Object.keys(a).length===0},I=async()=>{if(!r.profileImage||!s)return null;try{const a=`profile-${s.uid}-${Date.now()}`,t=F(O,`employee-profiles/${s.uid}/${a}`),i=R(t,r.profileImage);return new Promise((l,n)=>{i.on("state_changed",p=>{const B=p.bytesTransferred/p.totalBytes*100;f(B)},p=>{console.error("Upload error:",p),n(new Error(`Image upload failed: ${p.message}`))},async()=>{try{const p=await k(i.snapshot.ref);l(p)}catch{n(new Error("Failed to get download URL"))}})})}catch(a){return console.error("Error uploading image:",a),null}};return{formData:r,errors:b,loading:h,uploadProgress:c,imagePreview:y,handleChange:C,handleImageChange:w,handleSubmit:async a=>{if(a.preventDefault(),!!D()){m(!0),o({});try{if(!s){o({submit:"User not authenticated. Please login again."}),m(!1);return}const t=await I();if(!t){o({submit:"Failed to upload profile image. Please check file size (max 5MB) and try again."}),m(!1);return}const i={phone:r.phone,address:r.address,dateOfBirth:r.dateOfBirth,position:r.position,department:r.department,designations:r.designations,profileImage:t,profileComplete:!0,updatedAt:new Date},l=await v("employees",s.uid,i);l.success?(await v("users",s.uid,{profileComplete:!0,updatedAt:new Date}).catch(n=>{console.warn("Warning: Could not update user profile metadata:",n)}),setTimeout(()=>{d("/dashboards/dashboard/employee",{replace:!0})},500)):(o({submit:l.error||"Failed to update profile. Please try again."}),m(!1))}catch(t){console.error("Profile completion error:",t),o({submit:t instanceof Error?t.message:"An unexpected error occurred. Please try again."}),m(!1)}finally{f(0)}}}}};new Date().getFullYear();const z=["Sales","Social Media","SEO and Dev","Cleaning","Helper","Assistant","Accountant","Manager","HR","Worker"],J=()=>{const{formData:d,errors:s,loading:j,uploadProgress:h,imagePreview:m,handleChange:c,handleImageChange:f,handleSubmit:r}=$();return e.jsx("div",{className:"bg-gradient2 min-vh-100 align-items-center d-flex justify-content-center pt-2 pt-sm-5 pb-4 pb-sm-5",children:e.jsx(A,{children:e.jsx(N,{className:"justify-content-center",children:e.jsx(x,{lg:10,xl:8,children:e.jsx(q,{children:e.jsxs(M,{className:"p-4 p-sm-5",children:[e.jsx("div",{className:"mx-auto mb-4",children:e.jsx(U,{to:"/",className:"d-flex",children:e.jsx("img",{src:L,className:"align-self-center",alt:"logo-img",height:30})})}),e.jsx("h4",{className:"h4 mb-1 mt-4",children:"Complete Your Profile"}),e.jsx("p",{className:"text-muted mb-4",children:"Please fill in your profile information to get started."}),e.jsxs("form",{onSubmit:r,children:[e.jsxs(N,{children:[e.jsx(x,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"phone",className:"form-label",children:["Phone Number ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"tel",className:"form-control",id:"phone",placeholder:"Phone Number",name:"phone",value:d.phone,onChange:c}),s.phone&&e.jsx("small",{className:"text-danger",children:s.phone})]})}),e.jsx(x,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"dateOfBirth",className:"form-label",children:["Date of Birth ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"date",className:"form-control",id:"dateOfBirth",name:"dateOfBirth",value:d.dateOfBirth,onChange:c}),s.dateOfBirth&&e.jsx("small",{className:"text-danger",children:s.dateOfBirth})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"address",className:"form-label",children:["Address ",e.jsx("small",{children:"*"})]}),e.jsx("textarea",{className:"form-control",id:"address",placeholder:"Enter your address",name:"address",value:d.address,onChange:c,rows:3}),s.address&&e.jsx("small",{className:"text-danger",children:s.address})]}),e.jsxs(N,{children:[e.jsx(x,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"position",className:"form-label",children:["Position ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",id:"position",placeholder:"Your Position",name:"position",value:d.position,onChange:c}),s.position&&e.jsx("small",{className:"text-danger",children:s.position})]})}),e.jsx(x,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"department",className:"form-label",children:["Department ",e.jsx("small",{children:"*"})]}),e.jsxs("select",{className:"form-control",id:"department",name:"department",value:d.department,onChange:c,children:[e.jsx("option",{value:"",children:"Select Department"}),z.map(u=>e.jsx("option",{value:u,children:u},u))]}),s.department&&e.jsx("small",{className:"text-danger",children:s.department})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"designations",className:"form-label",children:"Designations / Skills"}),e.jsx("input",{type:"text",className:"form-control",id:"designations",placeholder:"e.g., Software Developer, Team Lead",name:"designations",value:d.designations,onChange:c})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"profileImage",className:"form-label",children:["Profile Picture ",e.jsx("small",{children:"*"})]}),e.jsx("div",{className:"border-2 border-dashed p-4 text-center rounded",children:m?e.jsxs("div",{children:[e.jsx("img",{src:m,alt:"Preview",className:"img-fluid rounded mb-3",style:{maxHeight:"200px"}}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",onChange:f})})]}):e.jsxs("div",{children:[e.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",onChange:f}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Click to upload your profile picture"})]})}),s.profileImage&&e.jsx("small",{className:"text-danger d-block mt-2",children:s.profileImage})]}),h>0&&h<100&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-muted mb-2",children:["Uploading... ",Math.round(h),"%"]}),e.jsx(T,{now:h})]}),s.submit&&e.jsx("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:s.submit}),e.jsx("div",{className:"mb-0 text-center d-grid gap-2",children:e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:j||h>0,children:j?"Completing Profile...":"Complete Profile & Continue"})})]})]})})})})})})};export{J as default};
