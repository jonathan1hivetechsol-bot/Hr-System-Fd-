import{u as S,h as T,r as f,i as v,k as F,s as k,m as O,n as R,j as e,C as U,R as y,a as x,L as A}from"./index-oFcejv4-.js";import{l as L}from"./logo-BJuW9rqy.js";import{C as M,a as q}from"./Card-9ozihno9.js";import{P as $}from"./ProgressBar-Cj9oUF59.js";const z=()=>{const m=S(),{user:a,userProfile:b}=T(),[u,d]=f.useState(!1),[c,h]=f.useState(0),[r,g]=f.useState({phone:"",address:"",dateOfBirth:"",position:"",department:"",designations:"",profileImage:null}),[w,C]=f.useState(null),[N,n]=f.useState({}),I=s=>{const{name:t,value:l}=s.target;g(o=>({...o,[t]:l})),N[t]&&n(o=>{const i={...o};return delete i[t],i})},D=s=>{const t=s.target.files?.[0];if(t){if(t.size>5*1024*1024){n(o=>({...o,profileImage:"Image size should be less than 5MB"}));return}g(o=>({...o,profileImage:t}));const l=new FileReader;l.onloadend=()=>{C(l.result)},l.readAsDataURL(t),N.profileImage&&n(o=>{const i={...o};return delete i.profileImage,i})}},B=()=>{const s={};return r.phone.trim()||(s.phone="Phone number is required"),r.address.trim()||(s.address="Address is required"),r.dateOfBirth||(s.dateOfBirth="Date of birth is required"),r.position.trim()||(s.position="Position is required"),r.department.trim()||(s.department="Department is required"),r.profileImage||(s.profileImage="Profile image is required"),n(s),Object.keys(s).length===0},E=async()=>{if(!r.profileImage||!a)return null;try{const s=`profile-${a.uid}-${Date.now()}`,t=F(k,`employee-profiles/${a.uid}/${s}`),l=O(t,r.profileImage);return new Promise((o,i)=>{const j=setTimeout(()=>{i(new Error("Image upload timeout - taking too long. Please check your connection."))},45e3);l.on("state_changed",p=>{const P=p.bytesTransferred/p.totalBytes*100;h(P),console.log(`Upload progress: ${Math.round(P)}%`)},p=>{clearTimeout(j),console.error("Upload error:",p),i(new Error(`Image upload failed: ${p.message}`))},async()=>{clearTimeout(j);try{const p=await R(l.snapshot.ref);o(p)}catch{i(new Error("Failed to get download URL"))}})})}catch(s){return console.error("Error uploading image:",s),null}};return{formData:r,errors:N,loading:u,uploadProgress:c,imagePreview:w,handleChange:I,handleImageChange:D,handleSubmit:async s=>{if(s.preventDefault(),!B())return;d(!0),n({});const t=setTimeout(()=>{console.error("Profile completion timeout - taking too long"),d(!1),n({submit:"Profile completion is taking too long. Please check your connection and try again."}),h(0)},6e4);try{if(console.log("Starting profile completion for user:",a?.uid),!a){clearTimeout(t),n({submit:"User not authenticated. Please login again."}),d(!1);return}console.log("Uploading profile image...");const l=await E();if(!l){clearTimeout(t),n({submit:"Failed to upload profile image. Please check file size (max 5MB) and try again."}),d(!1);return}console.log("Image uploaded successfully:",l);const o={phone:r.phone,address:r.address,dateOfBirth:r.dateOfBirth,position:r.position,department:r.department,designations:r.designations,profileImage:l,profileComplete:!0,updatedAt:new Date};console.log("Updating employee document...");const i=await v("employees",a.uid,o);i.success?(console.log("Employee profile updated successfully"),await v("users",a.uid,{profileComplete:!0,updatedAt:new Date}).catch(j=>{console.warn("Warning: Could not update user profile metadata:",j)}),clearTimeout(t),console.log("Redirecting to employee dashboard..."),setTimeout(()=>{m("/dashboards/dashboard/employee",{replace:!0})},500)):(clearTimeout(t),console.error("Profile update failed:",i.error),n({submit:i.error||"Failed to update profile. Please try again."}),d(!1))}catch(l){clearTimeout(t),console.error("Profile completion error:",l),n({submit:l instanceof Error?l.message:"An unexpected error occurred. Please try again."}),d(!1)}finally{h(0)}}}};new Date().getFullYear();const H=["Sales","Social Media","SEO and Dev","Cleaning","Helper","Assistant","Accountant","Manager","HR","Worker"],K=()=>{const{formData:m,errors:a,loading:b,uploadProgress:u,imagePreview:d,handleChange:c,handleImageChange:h,handleSubmit:r}=z();return e.jsx("div",{className:"bg-gradient2 min-vh-100 align-items-center d-flex justify-content-center pt-2 pt-sm-5 pb-4 pb-sm-5",children:e.jsx(U,{children:e.jsx(y,{className:"justify-content-center",children:e.jsx(x,{lg:10,xl:8,children:e.jsx(M,{children:e.jsxs(q,{className:"p-4 p-sm-5",children:[e.jsx("div",{className:"mx-auto mb-4",children:e.jsx(A,{to:"/",className:"d-flex",children:e.jsx("img",{src:L,className:"align-self-center",alt:"logo-img",height:30})})}),e.jsx("h4",{className:"h4 mb-1 mt-4",children:"Complete Your Profile"}),e.jsx("p",{className:"text-muted mb-4",children:"Please fill in your profile information to get started."}),e.jsxs("form",{onSubmit:r,children:[e.jsxs(y,{children:[e.jsx(x,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"phone",className:"form-label",children:["Phone Number ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"tel",className:"form-control",id:"phone",placeholder:"Phone Number",name:"phone",value:m.phone,onChange:c}),a.phone&&e.jsx("small",{className:"text-danger",children:a.phone})]})}),e.jsx(x,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"dateOfBirth",className:"form-label",children:["Date of Birth ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"date",className:"form-control",id:"dateOfBirth",name:"dateOfBirth",value:m.dateOfBirth,onChange:c}),a.dateOfBirth&&e.jsx("small",{className:"text-danger",children:a.dateOfBirth})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"address",className:"form-label",children:["Address ",e.jsx("small",{children:"*"})]}),e.jsx("textarea",{className:"form-control",id:"address",placeholder:"Enter your address",name:"address",value:m.address,onChange:c,rows:3}),a.address&&e.jsx("small",{className:"text-danger",children:a.address})]}),e.jsxs(y,{children:[e.jsx(x,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"position",className:"form-label",children:["Position ",e.jsx("small",{children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",id:"position",placeholder:"Your Position",name:"position",value:m.position,onChange:c}),a.position&&e.jsx("small",{className:"text-danger",children:a.position})]})}),e.jsx(x,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"department",className:"form-label",children:["Department ",e.jsx("small",{children:"*"})]}),e.jsxs("select",{className:"form-control",id:"department",name:"department",value:m.department,onChange:c,children:[e.jsx("option",{value:"",children:"Select Department"}),H.map(g=>e.jsx("option",{value:g,children:g},g))]}),a.department&&e.jsx("small",{className:"text-danger",children:a.department})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"designations",className:"form-label",children:"Designations / Skills"}),e.jsx("input",{type:"text",className:"form-control",id:"designations",placeholder:"e.g., Software Developer, Team Lead",name:"designations",value:m.designations,onChange:c})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"profileImage",className:"form-label",children:["Profile Picture ",e.jsx("small",{children:"*"})]}),e.jsx("div",{className:"border-2 border-dashed p-4 text-center rounded",children:d?e.jsxs("div",{children:[e.jsx("img",{src:d,alt:"Preview",className:"img-fluid rounded mb-3",style:{maxHeight:"200px"}}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",onChange:h})})]}):e.jsxs("div",{children:[e.jsx("input",{type:"file",className:"form-control",id:"profileImage",accept:"image/*",onChange:h}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Click to upload your profile picture"})]})}),a.profileImage&&e.jsx("small",{className:"text-danger d-block mt-2",children:a.profileImage})]}),u>0&&u<100&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-muted mb-2",children:["Uploading... ",Math.round(u),"%"]}),e.jsx($,{now:u})]}),a.submit&&e.jsx("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:a.submit}),e.jsx("div",{className:"mb-0 text-center d-grid gap-2",children:e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:b||u>0,children:b?"Completing Profile...":"Complete Profile & Continue"})})]})]})})})})})})};export{K as default};
